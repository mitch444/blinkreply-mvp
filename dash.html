<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DealerSignal Manager Dashboard</title>
  <style>
    :root {
      --bg: #0f141a;
      --panel: #151c23;
      --panel-2: #1c2530;
      --border: #2b3745;
      --text: #e6edf3;
      --muted: #9fb0c0;
      --accent: #47b1ff;
      --good: #2dd4bf;
      --warn: #f59e0b;
      --bad: #ef4444;
      --shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: "Segoe UI", Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    .page {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px;
    }

    #topNav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      padding: 16px 20px;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: var(--panel);
      margin-bottom: 16px;
      box-shadow: var(--shadow);
    }

    #brandBlock {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    #logo {
      width: 160px;
      height: 160px;
      object-fit: contain;
    }

    #brandTitle {
      font-size: 18px;
      font-weight: bold;
    }

    .helper-line {
      font-size: 13px;
      color: var(--muted);
    }

    #navActions {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .nav-link {
      font-size: 12px;
      color: var(--accent);
      text-decoration: none;
      border: 1px solid var(--border);
      padding: 6px 10px;
      border-radius: 6px;
      background: var(--panel-2);
    }

    .nav-link:hover {
      background: #223041;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 20px;
      margin-bottom: 24px;
    }

    .header h1 {
      margin: 0 0 6px;
      font-size: 24px;
    }

    .header p {
      margin: 0;
      color: var(--muted);
      font-size: 14px;
    }

    .kpi-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }

    .kpi {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 18px;
      box-shadow: var(--shadow);
    }

    .kpi .label {
      color: var(--muted);
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      margin-bottom: 8px;
    }

    .kpi .value {
      font-size: 28px;
      font-weight: bold;
    }

    .grid {
      display: grid;
      grid-template-columns: 2fr 1.2fr;
      gap: 18px;
    }

    .panel {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 18px;
      margin-bottom: 18px;
      box-shadow: var(--shadow);
    }

    .panel h2 {
      margin: 0 0 4px;
      font-size: 16px;
    }

    .panel .subtext {
      margin: 0 0 14px;
      color: var(--muted);
      font-size: 12px;
    }

    .bar-row {
      display: grid;
      grid-template-columns: 140px 1fr 90px;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
      font-size: 13px;
    }

    .bar {
      height: 10px;
      background: var(--panel-2);
      border-radius: 999px;
      overflow: hidden;
    }

    .bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #47b1ff, #2dd4bf);
      border-radius: 999px;
    }

    .daily-chart {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 10px;
      align-items: end;
      height: 160px;
    }

    .day-bar {
      background: var(--panel-2);
      border-radius: 8px;
      position: relative;
      height: 100%;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      padding-bottom: 6px;
      color: var(--muted);
      font-size: 11px;
    }

    .day-bar .fill {
      width: 100%;
      background: #47b1ff;
      border-radius: 8px;
    }

    .day-bar .label {
      position: absolute;
      bottom: -18px;
      width: 100%;
      text-align: center;
      font-size: 11px;
      color: var(--muted);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }

    th, td {
      text-align: left;
      padding: 8px 6px;
      border-bottom: 1px solid var(--border);
    }

    th {
      color: var(--muted);
      font-weight: 600;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    tr.highlight {
      background: rgba(45, 212, 191, 0.12);
    }

    .funnel {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 8px;
      align-items: stretch;
    }

    .funnel-step {
      background: var(--panel-2);
      border-radius: 10px;
      padding: 10px;
      text-align: center;
    }

    .funnel-step .count {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 6px;
    }

    .funnel-step .label {
      font-size: 12px;
      color: var(--muted);
    }

    .recent-item {
      display: grid;
      grid-template-columns: 1.2fr 1.2fr 0.8fr 1fr 0.8fr;
      gap: 8px;
      padding: 10px 0;
      border-bottom: 1px solid var(--border);
      font-size: 13px;
    }

    .recent-item:last-child { border-bottom: none; }

    .flag {
      color: var(--bad);
      font-weight: bold;
    }

    @media (max-width: 980px) {
      .grid { grid-template-columns: 1fr; }
      .header { flex-direction: column; align-items: flex-start; }
      .recent-item { grid-template-columns: 1fr 1fr; grid-auto-rows: auto; }
    }
  </style>
</head>
<body>
  <div class="page">
    <nav id="topNav">
      <div id="brandBlock">
        <img src="logo.png" alt="DealerSignal logo" id="logo" />
        <div>
          <div id="brandTitle">DealerSignal — BlinkReply Rapid Response (Local MVP)</div>
          <div class="helper-line">Speed-to-lead routing that plugs into PrairieCRM and syncs to DealerSocket.</div>
        </div>
      </div>
      <div id="navActions">
        <a href="index.html" class="nav-link">Rapid Response</a>
        <a href="dash.html" class="nav-link">Dashboard</a>
        <a href="eg.html" class="nav-link">Examples</a>
        <a href="settings.html" class="nav-link">Settings</a>
      </div>
    </nav>
    <div class="header">
      <div>
        <h1>DealerSignal — Manager Dashboard (Jan 2026)</h1>
        <p>Speed-to-lead performance overview powered by BlinkReply routing.</p>
      </div>
    </div>

    <div class="kpi-grid">
      <div class="kpi">
        <div class="label">Total Leads (Jan 2026)</div>
        <div class="value" id="kpiTotal">0</div>
      </div>
      <div class="kpi">
        <div class="label">Avg Response Time (seconds)</div>
        <div class="value" id="kpiAvg">0</div>
      </div>
      <div class="kpi">
        <div class="label">% Claimed &lt; 60s</div>
        <div class="value" id="kpiUnder60">0%</div>
      </div>
      <div class="kpi">
        <div class="label">% Claimed &lt; 120s</div>
        <div class="value" id="kpiUnder120">0%</div>
      </div>
    </div>

    <div class="grid">
      <div>
        <div class="panel">
          <h2>Leads by Source</h2>
          <p class="subtext">Volume mix and percent share by acquisition channel.</p>
          <div id="sourceChart"></div>
        </div>

        <div class="panel">
          <h2>Daily Lead Volume</h2>
          <p class="subtext">Mon–Sun totals for the current week snapshot.</p>
          <div class="daily-chart" id="dailyChart"></div>
        </div>

        <div class="panel">
          <h2>Sales Rep Performance</h2>
          <p class="subtext">Claim counts, response speed, and win rates.</p>
          <table>
            <thead>
              <tr>
                <th>Rep</th>
                <th>Leads Claimed</th>
                <th>Avg Response</th>
                <th>Win Rate</th>
              </tr>
            </thead>
            <tbody id="repTable"></tbody>
          </table>
        </div>
      </div>

      <div>
        <div class="panel">
          <h2>Funnel</h2>
          <p class="subtext">Contacted → Engaged → Appointments → Shows → Sold</p>
          <div class="funnel" id="funnel"></div>
        </div>

        <div class="panel">
          <h2>Recent Lead Activity</h2>
          <p class="subtext">Last 3 leads with ownership and response status.</p>
          <div id="recentLeads"></div>
        </div>
      </div>
    </div>
  </div>

  <script src="mockLeadsData.js"></script>
  <script>
    const sources = [
      "CarGurus",
      "AutoTrader",
      "HyundaiCanada.com",
      "Click to Buy",
      "Digital Media",
      "Optimy",
      "DrivingIt",
      "Unhaggle",
      "Other"
    ];

    const stages = ["Contacted", "Engaged", "Appointments", "Shows", "Sold"];

    function parseDate(value) {
      return value ? new Date(value) : null;
    }

    function responseTimeSec(lead) {
      if (!lead.claimedAt || !lead.createdAt) return null;
      const start = parseDate(lead.createdAt);
      const end = parseDate(lead.claimedAt);
      return Math.max(0, Math.round((end - start) / 1000));
    }

    function getJan2026Leads() {
      return mockLeadsData.filter(lead => {
        const created = parseDate(lead.createdAt);
        return created && created.getFullYear() === 2026 && created.getMonth() === 0;
      });
    }

    function renderKPIs(leads) {
      const claimed = leads.filter(l => l.claimedAt);
      const times = claimed.map(responseTimeSec).filter(v => v !== null);
      const avg = times.length ? Math.round(times.reduce((a, b) => a + b, 0) / times.length) : 0;
      const under60 = times.length ? Math.round((times.filter(t => t < 60).length / times.length) * 100) : 0;
      const under120 = times.length ? Math.round((times.filter(t => t < 120).length / times.length) * 100) : 0;

      document.getElementById("kpiTotal").innerText = leads.length;
      document.getElementById("kpiAvg").innerText = avg;
      document.getElementById("kpiUnder60").innerText = `${under60}%`;
      document.getElementById("kpiUnder120").innerText = `${under120}%`;
    }

    function renderSourceChart(leads) {
      const container = document.getElementById("sourceChart");
      container.innerHTML = "";
      const total = leads.length || 1;

      sources.forEach(source => {
        const count = leads.filter(l => l.source === source).length;
        const percent = Math.round((count / total) * 100);

        const row = document.createElement("div");
        row.className = "bar-row";

        const label = document.createElement("div");
        label.innerText = source;

        const bar = document.createElement("div");
        bar.className = "bar";
        const fill = document.createElement("div");
        fill.className = "bar-fill";
        fill.style.width = `${percent}%`;
        bar.appendChild(fill);

        const stat = document.createElement("div");
        stat.innerText = `${count} (${percent}%)`;

        row.appendChild(label);
        row.appendChild(bar);
        row.appendChild(stat);
        container.appendChild(row);
      });
    }

    function renderDailyChart(leads) {
      const chart = document.getElementById("dailyChart");
      chart.innerHTML = "";
      const days = ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"];
      const counts = new Array(7).fill(0);

      leads.forEach(lead => {
        const created = parseDate(lead.createdAt);
        if (!created) return;
        const index = (created.getDay() + 6) % 7;
        counts[index]++;
      });

      const max = Math.max(...counts, 1);

      days.forEach((day, idx) => {
        const wrapper = document.createElement("div");
        wrapper.className = "day-bar";

        const fill = document.createElement("div");
        fill.className = "fill";
        fill.style.height = `${Math.round((counts[idx] / max) * 100)}%`;

        const label = document.createElement("div");
        label.className = "label";
        label.innerText = day;

        wrapper.appendChild(fill);
        wrapper.appendChild(label);
        chart.appendChild(wrapper);
      });
    }

    function renderRepTable(leads) {
      const body = document.getElementById("repTable");
      body.innerHTML = "";
      const claimed = leads.filter(l => l.claimedAt && l.claimedBy);
      const totalClaims = claimed.length || 1;
      const repMap = {};

      claimed.forEach(lead => {
        if (!repMap[lead.claimedBy]) {
          repMap[lead.claimedBy] = { name: lead.claimedBy, count: 0, times: [] };
        }
        repMap[lead.claimedBy].count += 1;
        const time = responseTimeSec(lead);
        if (time !== null) repMap[lead.claimedBy].times.push(time);
      });

      const reps = Object.values(repMap).map(rep => {
        const avg = rep.times.length ? Math.round(rep.times.reduce((a, b) => a + b, 0) / rep.times.length) : 0;
        const winRate = Math.round((rep.count / totalClaims) * 100);
        return { ...rep, avg, winRate };
      }).sort((a, b) => b.count - a.count);

      let fastest = null;
      reps.forEach(rep => {
        if (fastest === null || rep.avg < fastest.avg) fastest = rep;
      });

      reps.forEach(rep => {
        const row = document.createElement("tr");
        if (fastest && rep.name === fastest.name) row.classList.add("highlight");

        row.innerHTML = `
          <td>${rep.name}</td>
          <td>${rep.count}</td>
          <td>${rep.avg}s</td>
          <td>${rep.winRate}%</td>
        `;
        body.appendChild(row);
      });
    }

    function renderFunnel(leads) {
      const container = document.getElementById("funnel");
      container.innerHTML = "";

      stages.forEach(stage => {
        const count = leads.filter(l => l.stage === stage).length;
        const step = document.createElement("div");
        step.className = "funnel-step";
        step.innerHTML = `
          <div class="count">${count}</div>
          <div class="label">${stage}</div>
        `;
        container.appendChild(step);
      });
    }

    function renderRecent(leads) {
      const container = document.getElementById("recentLeads");
      container.innerHTML = "";
      const sorted = [...leads].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
      const recent = sorted.slice(0, 3);

      recent.forEach(lead => {
        const time = responseTimeSec(lead);
        const status = lead.status || (lead.claimedAt ? "CLAIMED" : "OPEN");
        const claimedBy = lead.claimedBy || "—";
        const responseLabel = time !== null ? `${time}s` : "Unclaimed";
        const row = document.createElement("div");
        row.className = "recent-item";
        row.innerHTML = `
          <div>${lead.source}</div>
          <div>${lead.vehicle}</div>
          <div class="${!lead.claimedAt ? "flag" : ""}">${status}</div>
          <div>${claimedBy}</div>
          <div class="${!lead.claimedAt ? "flag" : ""}">${responseLabel}</div>
        `;
        container.appendChild(row);
      });
    }

    const leads = getJan2026Leads();
    renderKPIs(leads);
    renderSourceChart(leads);
    renderDailyChart(leads);
    renderRepTable(leads);
    renderFunnel(leads);
    renderRecent(leads);
  </script>
</body>
</html>
